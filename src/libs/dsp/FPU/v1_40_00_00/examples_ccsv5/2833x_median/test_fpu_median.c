// =====================================================================================
//  This software is licensed for use with Texas Instruments C28x
//  family DSCs.  This license was provided to you prior to installing
//  the software.  You may review this license by consulting a copy of
//  the agreement in the doc directory of this library.
// -------------------------------------------------------------------------------------
//          Copyright (C) 2014-2015 Texas Instruments, Incorporated.
//                          All Rights Reserved.
//======================================================================================
//
//  FILE:    Test_FPU_Median.c
//
//  TITLE:   Median of vector test
//
//  AUTHOR:  David M. Alter, Texas Instruments Inc.
//
//  HISTORY: 
//      12/18/07 - original (D. Alter)
//
//######################################################################################
// $TI Release: C28x Floating Point Unit Library V1.40.00.00 $
// $Release Date: Mar 10, 2014 $
//######################################################################################

#include "DSP28x_Project.h"     // Device Headerfile and Examples Include File
#include "fpu_vector.h"		    // Main include file

#include <stdlib.h>

// Global variables for median test
#define N 256

// Below is dummy random data from 0 to 1000, generated on MATLAB.  The median is 479.3322 (from MATLAB).
/*
float y[N] =
{
157.6131, 970.5928, 957.1669, 485.3756, 800.2805, 141.8863, 421.7613, 915.7355, 792.2073, 959.4924, 655.7407, \
 35.7117, 849.1293, 933.9932, 678.7352, 757.7401, 743.1325, 392.2270, 655.4779, 171.1867, 706.0461,  31.8328, \
276.9230,  46.1714,  97.1318, 823.4578, 694.8286, 317.0995, 950.2220,  34.4461, 438.7444, 381.5585, 765.5168, \
795.1999, 186.8726, 489.7644, 445.5862, 646.3130, 709.3648, 754.6867, 276.0251, 679.7027, 655.0980, 162.6117, \
118.9977, 498.3641, 959.7440, 340.3857, 585.2678, 223.8119, 751.2671, 255.0951, 505.9571, 699.0767, 890.9033, \
959.2914, 547.2155, 138.6244, 149.2940, 257.5083, 840.7173, 254.2822, 814.2848, 243.5250, 929.2636, 349.9838, \
196.5953, 251.0839, 616.0447, 473.2888, 351.6595, 830.8286, 585.2641, 549.7236, 917.1937, 285.8390, 757.2002, \
753.7291, 380.4458, 567.8216,  75.8543,  53.9501, 530.7976, 779.1672, 934.0107, 129.9062, 568.8237, 469.3906, \
 11.9021, 337.1226, 162.1823, 794.2845, 311.2150, 528.5331, 165.6487, 601.9819, 262.9713, 654.0791, 689.2145, \
748.1516, 450.5416,  83.8214, 228.9770, 913.3374, 152.3780, 825.8170, 538.3424, 996.1347,  78.1755, 442.6783, \
106.6528, 961.8981,   4.6342, 774.9105, 817.3032, 868.6947,  84.4358, 399.7826, 259.8704, 800.0685, 431.4138, \
910.6476, 181.8470, 263.8029, 145.5390, 136.0686, 869.2922, 579.7046, 549.8602, 144.9548, 853.0311, 622.0551, \
350.9524, 513.2495, 401.8080,  75.9667, 239.9162, 123.3189, 183.9078, 239.9525, 417.2671,  49.6544, 902.7161, \
944.7872, 490.8641, 489.2526, 337.7194, 900.0538, 369.2468, 111.2028, 780.2521, 389.7388, 241.6913, 403.9121, \
 96.4545, 131.9733, 942.0506, 956.1345, 575.2086,  59.7795, 234.7799, 353.1586, 821.1940,  15.4034,  43.0238, \
168.9900, 649.1155, 731.7224, 647.7460, 450.9237, 547.0089, 296.3208, 744.6928, 188.9550, 686.7754, 183.5112, \
368.4846, 625.6186, 780.2274,  81.1258, 929.3860, 775.7127, 486.7916, 435.8586, 446.7837, 306.3495, 508.5087, \
510.7716, 817.6277, 794.8314, 644.3181, 378.6094, 811.5805, 532.8256, 350.7271, 939.0016, 875.9428, 550.1563, \
622.4751, 587.0447, 207.7423, 301.2463, 470.9233, 230.4882, 844.3088, 194.7643, 225.9218, 170.7080, 227.6643, \
435.6987, 311.1023, 923.3796, 430.2074, 184.8163, 904.8810, 979.7484, 438.8700, 111.1192, 258.0647, 408.7198, \
594.8961, 262.2117, 602.8431, 711.2158, 221.7467, 117.4177, 296.6759, 318.7783, 424.1668, 507.8583,  85.5158, \
262.4822, 801.0146,  29.2203, 928.8541, 730.3309, 488.6090, 578.5251, 237.2836, 458.8488, 963.0885, 546.8057, \
521.1358, 231.5944, 488.8977, 624.0601, 679.1355, 395.5152, 367.4366, 987.9820,  37.7389, 885.1680, 913.2868, \
796.1839,  98.7123, 261.8712
};
*/

// Below is another set of dummy data.  The median is 12.85255 (from MATLAB).

float y[N] =
{
12.19168,13.48177,9.672562,17.14658,11.5909,191.4419,1184.141,1167.395,1502.389,1495.243,114.3037,2071.024, \
3201.526,1044.094,21.99172,20.97584,23.32301,157.3204,649.0411,485.5262,48.10452,14.09932,17.06327,9.995614, \
5.11096,11.0976,15.60884,16.91417,13.92589,74.28383,1075.365,1605.742,498.5687,36.67439,24.23219,32.15402, \
29.37286,19.00746,9.211133,5.833984,9.21144,3.086432,3.345149,14.66748,19.33414,5.85521,8.076886,15.46299, \
362.6209,920.1544,501.1625,29.40777,12.79311,10.71749,12.13408,12.09552,2.526673,3.012374,5.746968,3.743192, \
14.56582,24.73923,8.199355,26.81978,573.0521,2177.615,1651.384,168.8588,14.79742,13.51916,22.3394,13.70991, \
7.619604,18.91193,7.778588,19.80246,23.08303,12.05103,28.78516,28.28251,26.23976,17.42372,15.65855,15.28291, \
27.38075,4.427674,22.49833,16.93548,10.21448,7.241852,3.00595,22.14155,26.45595,20.85637,14.94555,13.29958, \
5.898098,13.72441,6.915655,7.55016,8.541886,3.680868,13.8379,11.40113,5.681583,6.393003,9.092524,10.54152, \
7.585142,2.315934,7.137956,17.57874,20.99539,25.46121,13.95748,7.234218,20.83268,28.16425,24.59051,20.48596, \
15.53774,7.686494,6.197204,3.700261,11.7758,16.03405,10.48978,3.254613,2.187421,4.736376,10.1121,14.59561, \
22.99097,6.619585,6.106548,5.058514,5.443498,9.260204,15.03301,5.310428,9.021931,15.26645,16.16863,4.523194, \
5.990127,4.116846,4.175852,2.358719,7.460144,0.8632574,11.60635,4.266328,11.53149,20.47762,24.3912,12.36298, \
8.372893,12.81578,5.46927,14.03916,9.619642,1.70925,9.294674,2.100016,7.700324,4.511101,5.775788,11.33173, \
4.746154,6.156952,10.61672,12.54807,14.60796,13.18635,7.452223,5.477423,9.264193,12.35976,16.72466,13.99664, \
16.51772,9.706166,14.77145,17.23729,16.52573,5.890752,15.37105,17.84378,1.880526,7.595114,8.990695,3.679067, \
11.09691,8.717255,8.027496,12.28305,14.11357,8.814338,20.44462,32.0938,21.52484,14.51647,15.31221,14.10452, \
9.4774,8.811275,14.15401,31.23236,28.69613,8.331853,14.2571,18.50488,12.28013,9.615168,9.538313,8.659797, \
10.37351,16.42991,12.57029,27.14095,17.0107,2.612407,2.643283,14.82469,11.72474,4.252764,4.563026,6.095563, \
4.372216,10.70996,11.26732,8.826683,5.527815,10.55455,9.249767,12.88932,17.27485,7.695302,17.64387,14.96466, \
11.54743,14.33588,16.21518,16.52447,18.97447,16.82012,27.5438,13.75019,4.219778,7.582984,13.52279,11.99234, \
23.43739,18.10006,16.34237,5.943192
};

float x[N];
float z;


void main(void)
{
	
//--- CPU Initialization
    InitSysCtrl();                      // Initialize the CPU
    DINT;
    InitPieCtrl();                      // Initialize and enable the PIE
    IER = 0x0000;
    IFR = 0x0000;
    InitPieVectTable();
    EINT;                               // Enable Global interrupt INTM
    ERTM;                               // Enable Global realtime interrupt DBGM

// median() test
	memcpy_fast(x, y, N<<1);					// Start with same data
	z = 0.0;
	asm(" NOP");
	z = median_SP_RV(x, N);
	asm(" NOP");

// median_noreorder() test
	memcpy_fast(x, y, N<<1);					// Start with same data
	z = 0.0;
	asm(" NOP");
	z = median_noreorder_SP_RV(x, N);
	asm(" NOP");

//--- Main Loop
	while(1)							// Dummy loop.  Wait for an interrupt.
	{
		asm(" NOP");
	}

} // end of main()

//===========================================================================
// End of File
//===========================================================================
